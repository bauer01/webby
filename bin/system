#!/usr/bin/env php
<?php

// Load DI container
$container = require __DIR__ . '/../app/bootstrap.php';

$application = new \Symfony\Component\Console\Application();
$application->addCommands([
    new \Webby\Console\System\AssetsCommand(
        $container->getByType(\Webby\System\Theme::class),
        $container->getByType(\Webby\System\Assets::class)
    ),
    new \Webby\Console\System\BootstrapCommand(
        __DIR__ . "/../bootstrap",
        __DIR__ . "/../content"
    ),
    new \Webby\Console\System\InstallCommand(),
    new \Webby\Console\System\PackageCommand(),
    new \Webby\Console\System\RobotsCommand(
        $container->getByType(\Webby\System\Robots::class)
    ),
    new \Webby\Console\System\SitemapCommand(
        $container->getByType(\Webby\System\Sitemap::class)
    ),
    new \Webby\Console\System\Particles\GetAllCommand(
        $container->getByType(\Webby\System\Particles::class)
    )
]);

$application->setCatchExceptions(false);
try {
    $output = new Symfony\Component\Console\Output\ConsoleOutput();
    $application->run(null, $output);
} catch (Exception $e) {

    $application->renderException($e, $output);

    \Tracy\Debugger::log($e);
    $statusCode = $e->getCode();
    $statusCode = is_numeric($statusCode) && $statusCode ? $statusCode : 1;
    exit($statusCode);
}